{
  "hash": "586992b90994865ff9a931f7e5d3b055",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"TTC Bus Delay Project DSCI 522\"\nauthor: \"Agam Sanghera\"\ndate: \"2025-01-18\"\ncategories: [code, analysis]\nimage: \"buslate.png\"\nbibliography: references.bib\nexecute:\n    echo: false\n    warning: false\n    message: false\neditor: source\n---\n\n![Map of TTC Busses](Schedule.png){#fig-map width=\"70%\"}\n\nNo one likes being late, especially when it is due to factors out of oneâ€™s control, but would it not be nice if those factors could be mitigated. Public transport delays are one of the leading factors causing delays, more specifically - Bus Delays. These delays are unavoidable and can affect the efficiency of services and may enhance operational decision-making and increase commuter satisfaction.\nThis post examines the 2024 TTC bus delay dataset to forecast delay times based on factors such as route, incident type, location, and time. We aim to classify delays into short, medium, and long categories using a logistic regression model. The final logistic regression model show moderate effectiveness in predicting delay durations. Predicted frequencies for short and medium delays correspond with actual data; however, the model under predicts long delays, highlighting the complexity of accurately capturing extended durations and their contributing factors. This study acts as a foundation for the implementation of real-time prediction models that could aid the Toronto Transit Commission in resource allocation and improving schedule adherence.\n\n\n## Data\n\nThe data for this analysis was sourced from the [open.toronto.ca](http://open.toronto.ca) website, with a specific emphasis on the bus delay data for the year 2024. Raw data can be found [here](https://open.toronto.ca/dataset/ttc-bus-delay-data/) and the map displayed in \n@fig-map can be obtained [here](https://www.ttc.ca/routes-and-schedules)\n\n::: {#tbl-ttc_head .cell tbl-cap='Snippet of TTC bus delay data' execution_count=1}\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Date</th>\n      <th>Route</th>\n      <th>Time</th>\n      <th>Day</th>\n      <th>Location</th>\n      <th>Incident</th>\n      <th>Min Delay</th>\n      <th>Min Gap</th>\n      <th>Direction</th>\n      <th>Vehicle</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2024-01-01</td>\n      <td>89</td>\n      <td>02:08</td>\n      <td>Monday</td>\n      <td>KEELE AND GLENLAKE</td>\n      <td>Vision</td>\n      <td>10</td>\n      <td>20</td>\n      <td>N</td>\n      <td>7107</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2024-01-01</td>\n      <td>39</td>\n      <td>02:30</td>\n      <td>Monday</td>\n      <td>FINCH STATION</td>\n      <td>General Delay</td>\n      <td>20</td>\n      <td>40</td>\n      <td>NaN</td>\n      <td>8914</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2024-01-01</td>\n      <td>300</td>\n      <td>03:13</td>\n      <td>Monday</td>\n      <td>BLOOR AND MANNING</td>\n      <td>General Delay</td>\n      <td>0</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>8562</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2024-01-01</td>\n      <td>65</td>\n      <td>03:23</td>\n      <td>Monday</td>\n      <td>PARLIAMENT AND BLOOR</td>\n      <td>Security</td>\n      <td>0</td>\n      <td>0</td>\n      <td>N</td>\n      <td>8574</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2024-01-01</td>\n      <td>113</td>\n      <td>03:37</td>\n      <td>Monday</td>\n      <td>MAIN STATION</td>\n      <td>Security</td>\n      <td>0</td>\n      <td>0</td>\n      <td>NaN</td>\n      <td>8541</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThe dataset contains in total 45300 rows and 10 columns. Each row in the dataset represents one instance of delay, specifying its route, date and time, location, classification of bus incident, and its delay duration. A snippet of the dataset is show in @tbl-ttc_head.\n\n## Analysis\n\nBefore diving into the analysis, the data is first visually assessed, this is done by performing an exploratory data analysis by means of plots, figures and charts of the distributions of features of interest.\nThe EDA is conducted on the dataset with the following objectives:\n\n1.  **Loading and Preprocessing Data:** Handling missing values, converting timestamp data to day parts, and cleaning data fields irrelevant to our delay analysis.\n2.  **Visualization:** Analyze the distribution of delays, identify top routes and locations with frequent delay incidents, and visualize delays based on day and incident type.\n\nA logistic regression model is then used to build the classification model to predict whether a delay falls into the short, medium or long duration. The C parameter in the logistic regression model is chosen using a 5-fold cross validation with the classification accuracy as the metric.\n\nThe reason for using logistic regression is that the coefficients of the model can be interpreted to understand the influence of different features on the probability of each delay class. This interpretability can be valuable in understanding the factors contributing to delays\n\nThe Python programming language (@Python) and the following Python packages are used to perform tbe analysis: numpy (@numpy), Pandas (@pandas), altair (@altair), scikit-learn (@scikit-learn). The code used to perform the analysis and generate the figures can be found [here](https://github.com/UBC-MDS/group04/tree/main/scripts).\n\n## Results and Discussion\n\nThe EDA of the TTC bus delay data uncovers several key insights.\n\n![Distributions of hourly incidents](../../results/images/incidents_by_hour.png){#fig-incidents_by_hour width=\"70%\"}\n\n@fig-incidents_by_hour shows that majority of the delays occur during the late evenings, most likely due to the influx of people returning back home from work.\n\n![Distributions of hourly incidents](../../results/images/incidents_by_day.png){#fig-incidents_by_day width=\"70%\"}\n\n@fig-incidents_by_day indicates that Tuesday through Friday are the days with the highest delays, suggesting a potential correlation with weekday commuter traffic.\n\n![Types of incidents and their counts](../../results/images/incident_types.png){#fig-incident_types width=\"70%\"}\n\n@fig-incident_types show that mechanical issues are the primary cause of delays, comprising a substantial portion, followed by operator-related operations and diversions. This finding indicates potential areas for intervention, such as improved maintenance or optimized scheduling, to mitigate delay incidents.\n\nThe EDA was very informative in understanding the features of interest for this project, which will be used to create the logistic regression model to predict the expected delay. The delay output is categorized into \"Short\", \"Medium\" or \"Long\". 5-fold cross-validation and randomized grid search were applied for C hyperparameter tuning to enhance model performance.\nThe value for C at which performance was observed to be the best, was: 0.1, and the comparison between the predictions and the actual delay classes can be observed in @fig-predicted_vs_actual  \n\n![Comparitive analysis](../../results/images/PredictedVsActual.png){#fig-predicted_vs_actual width=\"70%\"}\n\nThe results of the logistic regression model in @fig-predicted_vs_actual show moderate effectiveness in predicting delay durations. Predicted frequencies for short and medium delays correspond with actual data; however, the model underpredicts long delays, highlighting the complexity of accurately capturing extended durations and their contributing factors. We could explore more advanced predictive models to improve accuracy. Furthermore, more data integration such as weather conditions could enhance model performance.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}